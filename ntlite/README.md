NTLite
===================
Here is resting the NTLite configuration files.

----------

## Configuration files

In `configs/`:
* **common.xml** - used as personal primary configuration for Windows 7+ images.
* **w7_pro** - especially for Windows 7.
* **w10_guest** - especially for Windows 10 as guest OS.

In `registration-entries/`:
* **wb_activesetup.py** - Python tool to generate Batch file for adding HKCU subkeys in HKLM Active Setup
* **registration-entries.xml** - example of XML file containing the HCKU subkeys"
* `HKCU/*.reg` - waiting for another tool to convert .reg into XML

The config files can be used in conjunction (common.xml & w7_pro or common.xml & w10_guest).

## Post-Setup 
It's a NTLite feature that allows you to execute commands or add [registration entrie files](https://en.wikipedia.org/wiki/Windows_Registry#.REG_files) after Windows Setup has completed.
We take advantage of that feature to optimize and custom some configurations automatically.

### Adding registration entries for all users

First point, do not import a REG or similar (like scripts) to add/edit/delete a HKEY_CURRENT_USER's registry key to Post-Setup, thinking that could apply the change for all users.

>**Active Setup** is useful if you need to add an entry to HKCU for all users of a machine. It works by adding a key to HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\%package name% with a version number. When a user logs in Windows checks this location and compares it to HKCU\SOFTWARE\Microsoft\Active Setup\Installed Components\%package name%. **If it is missing or a lower version then it runs whatever has been set in HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\%package name%\StubPath.**
> -- <cite>[WPKG.org](https://wpkg.org/Adding_Registry_Settings#Adding_entries_to_HKCU_for_all_users)</cite>

For instance (in REG format) :
```
[HKLM\SOFTWARE\Microsoft\Active Setup\Installed Components\SearchboxTaskbarMode]
"Version"="1"
"StrubPath"="reg add HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Search /v SearchboxTaskbarMode /d 0 /t REG_DWORD /f"

```

### Run automatically the processus above via NTLite Post-Setup
Purpose:
Import a BAT/PS1 script meant to be execute during the post-setup phase.
Or import a .REG file (generated by a script).

Idea:
Supposing a script, it would parse a XML (or any other declarative format) that contains new subkeys or entries to the registry.
It finally would generate a REG-Add commands Batch script to import to NTLite.

For instance: 
``` 
<?xml version="1.0" encoding="utf-8"?>
<regEntries>
	<entry>
		<keyName>HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Search</keyName>
		<valueName>SearchboxTaskbarMode</valueName>
		<data>0</data>
		<dataType>REG_DWORD</dataType>
		<separator></separator>
	</entry>
<regEntries>
```
Example of generated Batch script.
```
reg add "HLM\SOFTWARE\Microsoft\Active Setup\Installed Components\SearchboxTaskbarMode" 
	/v "Version" 
	/d "1" 
	/t REG_SZ 
	/f
	
reg add "HLM\SOFTWARE\Microsoft\Active Setup\Installed Components\SearchboxTaskbarMode" 
	/v "StubPath" 
	/d "reg add HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Search 
		/v "SearchboxTaskbarMode" 
		/d "0" 
		/t REG_DWORD /f" 
	/f
```

Finally, there's nothing for it but to import the Batch script to the NTLite's Post-Setup section.

## TODO

* Make Python tool to convert .REG into .XML
* ~~Make Python tool to generate Batch file to add HKCU subkeys in HKLM\...\Active Setup (as above)~~
* ~~Suggest that NTLite developers add a made-to-measure feature to remove useless drivers according to the local machine~~
